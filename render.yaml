services:
  - type: web
    name: family-tree-app
    env: python
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn family_tree.wsgi:app --bind 0.0.0.0:8000
    staticAssets:
      - path: /static
        destination: static
    plan: free
    envVars:
      - key: DATABASE_URL
        value: postgresql://hassaniyine_o9yq_user:ukL2XI6fd6i7eQpO0uZ39VteUsb1dQ3s@dpg-d1m3j4ali9vc73coor00-a/hassaniyine_o9yq

    releaseCommand: |
    releaseCommand: |
      flask shell -c "from family_tree.database import db; print('✅ DATABASE:', db.engine.url); db.create_all()"
      flask shell -c "from family_tree.insertion import full_initialize; full_initialize()"
      flask shell -c "from family_tree.database import db; db.drop_all()"  # Supprime les tables
      flask shell -c "from family_tree.create_persons import create_persons_table; create_persons_table()"  # Recrée les tables
      flask shell -c "from family_tree.insertion import full_initialize; full_initialize()"  # Repeuple
      flask shell -c "from family_tree.fix_names import fix_names; fix_names()"  # Applique les corrections
