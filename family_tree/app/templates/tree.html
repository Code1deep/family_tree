<!-- app/templates/tree.html -->
{% extends "base_template.html" %}

{% block content %}
<h1 class="text-center mb-4">شجرة العائلة الحسنة</h1>

<div class="header-actions text-center mb-3">
  <a href="/add" class="btn btn-success me-2">➕ إضافة فرد جديد</a>
  <button id="fullscreen-btn" class="btn btn-secondary me-2">🖼️ ملء الشاشة</button>
  <button id="center-btn" class="btn btn-info me-2">🎯 توسيط</button>
  <button id="export-png" class="btn btn-warning me-2">⬇️ تصدير PNG</button>
  <button id="export-svg" class="btn btn-warning me-2">⬇️ تصدير SVG</button>
  <input id="search-box" type="text" class="form-control d-inline-block w-auto" placeholder="🔍 ابحث عن اسم" />
</div>

<!-- ✅ L’élément indispensable que les JS cherchent -->
<div id="tree-container" class="tree-container"></div>

<!-- Bouton pour ouvrir le modal -->
<button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#personModal">
  Créer une personne
</button>

<!-- Modal Bootstrap contenant le formulaire -->
<div class="modal fade" id="personModal" tabindex="-1" aria-labelledby="personModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="personModalLabel">Créer une personne</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
      </div>
      <div class="modal-body">
        {% include "tree_form.html" %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}

<style>
/* CSS intégré pour le rendu D3.js  */
/* Nœuds D3 */
.node circle {
  fill: #999;
  stroke: steelblue;
  stroke-width: 2px;
}
.node text {
  font: 12px sans-serif;
}
.link {
  fill: none;
  stroke: #ccc;
  stroke-width: 2px;
}

/* Styles supplémentaires pour les blocs de génération */
.ft-node {
  border-radius: 5px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.ft-gener-0 { background-color: #6a0dad; }
.ft-gener-1 { background-color: #1e90ff; }
.ft-gener-2 { background-color: #32cd32; }
.ft-gener-3 { background-color: #ff8c00; }
.ft-gener-4 { background-color: #ff1493; }
</style>

<script>
// Attend que la page soit complètement chargée
window.addEventListener('load', () => {
    // Charge les scripts dans l'ordre
    const script1 = document.createElement('script');
    script1.src = "{{ url_for('static', filename='js/tree/utils.js') }}";
    script1.type = 'module';
    
    const script2 = document.createElement('script');
    script2.src = "{{ url_for('static', filename='js/tree/d3-tree.js') }}";
    script2.type = 'module';
    
    const script3 = document.createElement('script');
    script3.src = "{{ url_for('static', filename='js/tree/core.js') }}";
    script3.type = 'module';

    // Ajoute les scripts au DOM un par un
    document.body.appendChild(script1);
    script1.onload = () => {
        document.body.appendChild(script2);
        script2.onload = () => {
            document.body.appendChild(script3);
        };
    };
});
</script>
{% endblock %}
<!-- Modules JavaScript -->
<script type="module" src="{{ url_for('static', filename='js/tree.js') }}"></script>

{% endblock %}
